replicaCount: 1
image:
  repository: icl00ud/velure-publish-order
  tag: "latest"
  pullPolicy: Always
service:
  type: ClusterIP
  port: 3030

ingress:
  enabled: true
  className: "alb"
  annotations:
    alb.ingress.kubernetes.io/group.name: velure-public
    alb.ingress.kubernetes.io/group.order: "30"
    alb.ingress.kubernetes.io/scheme: internet-facing
    alb.ingress.kubernetes.io/target-type: ip
    alb.ingress.kubernetes.io/healthcheck-path: /health
    alb.ingress.kubernetes.io/healthcheck-interval-seconds: "15"
    alb.ingress.kubernetes.io/healthcheck-timeout-seconds: "5"
    alb.ingress.kubernetes.io/success-codes: "200"
    alb.ingress.kubernetes.io/listen-ports: '[{"HTTP": 80}]'
  hosts:
    - host: ""
      paths:
        - path: /api/order
          pathType: Prefix
  tls: []

resources:
  requests:
    cpu: 100m
    memory: 128Mi
  limits:
    cpu: 100m
    memory: 128Mi
autoscaling:
  enabled: false
  minReplicas: 2
  maxReplicas: 5
  targetCPUUtilizationPercentage: 80
  targetMemoryUtilizationPercentage: 65
order:
  exchange: orders
livenessProbe:
  httpGet:
    path: /health
    port: http
  initialDelaySeconds: 10
  periodSeconds: 10
  timeoutSeconds: 2
readinessProbe:
  httpGet:
    path: /health
    port: http
  initialDelaySeconds: 5
  periodSeconds: 10
  timeoutSeconds: 2
securityContext:
  runAsNonRoot: true
  runAsUser: 65532
  runAsGroup: 65532
  allowPrivilegeEscalation: false
  readOnlyRootFilesystem: true

# Secrets configuration
# For production: use External Secrets Operator to sync from AWS Secrets Manager
# Set secrets.create=false when using ExternalSecrets
secrets:
  create: false  # Set to true only for local development
  # External secret names (used when secrets.create=false)
  externalSecretName: "velure-publish-order-secrets"
  # Placeholder values for local development (override with helm --set or separate values file)
  rabbitmq:
    url: ""  # Will be populated from AWS Secrets Manager
  postgres:
    url: ""  # Will be populated from AWS Secrets Manager

# External Secrets Operator configuration
externalSecrets:
  enabled: true
  refreshInterval: "1h"
  secretStoreRef:
    name: aws-secrets-manager
    kind: ClusterSecretStore
  # AWS Secrets Manager secret names
  awsSecrets:
    rabbitmq: "velure/production/rabbitmq"
    postgres: "velure/production/rds-orders"

# Prometheus metrics configuration
metrics:
  enabled: true
  serviceMonitor:
    enabled: true
    interval: 30s
    scrapeTimeout: 10s
    labels:
      prometheus: kube-prometheus
