# ⚠️ IMPORTANT: This is an EXAMPLE file
# DO NOT commit the actual secret to git!
#
# To use:
# 1. Copy this file: cp secret.yaml.example secret.yaml
# 2. Edit secret.yaml with your actual credentials
# 3. Apply: kubectl apply -f secret.yaml
# 4. Delete the file or keep it out of git (.gitignore)

---
apiVersion: v1
kind: Secret
metadata:
  name: pgbouncer-secret
  namespace: velure-db
  labels:
    app: pgbouncer
type: Opaque
stringData:
  # RDS PostgreSQL host
  # Example: velure-production-auth.cw9gu66melkv.us-east-1.rds.amazonaws.com
  db-host: "your-rds-endpoint.us-east-1.rds.amazonaws.com"

  # Database user
  db-user: "postgres"

  # Database password
  db-password: "your-actual-password-here"

  # Optional: Connection string for monitoring
  # connection-string: "postgresql://postgres:password@rds-endpoint:5432/postgres?sslmode=require"

---
# Alternative: Create secret via kubectl command (recommended for production)
# This doesn't leave credentials in files

# kubectl create secret generic pgbouncer-secret \
#   --from-literal=db-host='velure-production-auth.cw9gu66melkv.us-east-1.rds.amazonaws.com' \
#   --from-literal=db-user='postgres' \
#   --from-literal=db-password='your-password-here' \
#   --namespace velure-db

---
# Alternative: Use External Secrets Operator (best practice)
# Sync from AWS Secrets Manager

apiVersion: external-secrets.io/v1beta1
kind: ExternalSecret
metadata:
  name: pgbouncer-secret
  namespace: velure-db
spec:
  refreshInterval: 1h
  secretStoreRef:
    kind: SecretStore
    name: aws-secrets-manager  # Reference to your SecretStore
  target:
    name: pgbouncer-secret
    creationPolicy: Owner
  data:
  - secretKey: db-host
    remoteRef:
      key: velure/rds/auth  # AWS Secrets Manager secret name
      property: host
  - secretKey: db-user
    remoteRef:
      key: velure/rds/auth
      property: username
  - secretKey: db-password
    remoteRef:
      key: velure/rds/auth
      property: password
